/*    
 * Copyright (c) 2014 Samsung Electronics Co., Ltd.   
 * All rights reserved.   
 *   
 * Redistribution and use in source and binary forms, with or without   
 * modification, are permitted provided that the following conditions are   
 * met:   
 *   
 *     * Redistributions of source code must retain the above copyright   
 *        notice, this list of conditions and the following disclaimer.  
 *     * Redistributions in binary form must reproduce the above  
 *       copyright notice, this list of conditions and the following disclaimer  
 *       in the documentation and/or other materials provided with the  
 *       distribution.  
 *     * Neither the name of Samsung Electronics Co., Ltd. nor the names of its  
 *       contributors may be used to endorse or promote products derived from  
 *       this software without specific prior written permission.  
 *  
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR  
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT  
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE  
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

(function(e,t){if(typeof define==="function"){if(define.amd){define(t)}else{try{define({name:"m2x",def:t})}catch(n){e.M2X=t()}}}else{e.M2X=t()}})(this,function(){var e=function(e){function i(e){var r=new XMLHttpRequest,i,s;if(typeof e.body!=="undefined"){if(!n.isObj(e.body)){throw new Error("Request body should be an object")}}i=t.base_end_point+e.path;if(n.isObj(e.urlparams)){i+="?";for(s in e.urlparams){i+=encodeURIComponent(s)+"="+encodeURIComponent(e.urlparams[s])+"&"}i=i.slice(0,-1)}r.open(e.verb,i,true);r.setRequestHeader("X-M2X-KEY",t.key);if(typeof e.body!=="undefined"){r.setRequestHeader("Content-Type","application/json")}else{r.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}r.onreadystatechange=function(){var i;if(r.readyState===4){if(!t.forward_errors){if(r.status===200||r.status===201||r.status===202||r.status===204){if(n.isFunc(e.onSuccess)){i={status:r.status,response:r.responseText?JSON.parse(r.responseText):{}};e.onSuccess.apply({},[i])}}else{if(n.isFunc(e.onError)){i={status:r.status,response:r.responseText?JSON.parse(r.responseText):{}};e.onError.apply({},[i])}}}else{if(n.isFunc(e.onSuccess)){i={status:r.status,response:r.responseText?JSON.parse(r.responseText):{}};e.onSuccess.apply({},[i])}}}};r.send(JSON.stringify(e.body)||"")}var t={base_end_point:"https://api-m2x.att.com/v2",key:undefined,forward_errors:false},n={isObj:function(e){return Object.prototype.toString.call(e)==="[object Object]"},isFunc:function(e){return typeof e==="function"},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isString:function(e){return typeof e==="string"},isDate:function(e){return Object.prototype.toString.call(obj)==="[object Date]"},checkObjectHasProperties:function(e,t){if(!n.isObj(e)){throw new Error("Parameter mismatch. "+e+" is not an object")}t.forEach(function(t){if(!e.hasOwnProperty(t)||typeof e[t]==="undefined"||Object.prototype.toString.call(e[t])==="[object Null]"){throw new Error("Object must have a property "+t+" and contain a valid value")}})},formatURL:function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,function(t,n){return typeof e[n]!=="undefined"?encodeURIComponent(e[n]):t})}},r={};if(typeof e==="undefined"||typeof e["key"]==="undefined"||!n.isString(e["key"])){throw new Error("A valid M2X Key must be provided")}t.key=e.key;r.device={search:function(e,t,r){var s=e,o=t,u=r;if(n.isFunc(s)){s={};o=e;u=t}i({verb:"GET",path:"/devices",urlparams:s,onSuccess:o,onError:u})},searchDeviceTags:function(e,t,r){var s=e,o=t,u=r;if(n.isFunc(s)){s={};o=e;u=t}i({verb:"GET",path:"/devices/tags",urlparams:s,onSuccess:o,onError:u})},create:function(e,t,r){n.checkObjectHasProperties(e,["name","visibility"]);i({verb:"POST",path:"/devices",body:e,onSuccess:t,onError:r})},update:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(t,["name","visibility"]);i({verb:"PUT",path:n.formatURL("/devices/{1}",e),body:t,onSuccess:r,onError:s})},getDetails:function(e,t,r){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/devices/{1}",e),onSuccess:t,onError:r})},getLocation:function(e,t,r){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/devices/{1}/location",e),onSuccess:t,onError:r})},updateLocation:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(t,["latitude","longitude"]);i({verb:"PUT",path:n.formatURL("/devices/{1}/location",e),body:t,onSuccess:r,onError:s})},getDataStreams:function(e,t,r){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/devices/{1}/streams",e),onSuccess:t,onError:r})},updateStream:function(e,t,r,s,o){var u=r,a=s,f=o;if(n.isFunc(r)){u={};a=r;f=s}if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"PUT",path:n.formatURL("/devices/{1}/streams/{2}",e,t),body:u,onSuccess:a,onError:f})},updateDataStreamValue:function(e,t,r,s,o){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}n.checkObjectHasProperties(r,["value"]);i({verb:"PUT",path:n.formatURL("/devices/{1}/streams/{2}/value",e,t),body:r,onSuccess:s,onError:o})},getDataStreamDetails:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"GET",path:n.formatURL("/devices/{1}/streams/{2}",e,t),onSuccess:r,onError:s})},getDataStreamValues:function(e,t,r,s,o){var u=r,a=s,f=o;if(n.isFunc(u)){u={};a=r;f=s}if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"GET",path:n.formatURL("/devices/{1}/streams/{2}/values.json",e,t),urlparams:u,onSuccess:a,onError:f})},getDataStreamStats:function(e,t,r,s,o){var u=r,a=s,f=o;if(n.isFunc(u)){u={};a=r;f=s}if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"GET",path:n.formatURL("/devices/{1}/streams/{2}/stats",e,t),urlparams:u,onSuccess:a,onError:f})},postDataStreamValues:function(e,t,r,s,o){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}if(n.isArray(r)){r.forEach(function(e){n.checkObjectHasProperties(e,["timestamp","value"])})}else{throw new Error("Values should be an array of objects")}i({verb:"POST",path:n.formatURL("/devices/{1}/streams/{2}/values",e,t),body:{values:r},onSuccess:s,onError:o})},deleteDataStreamValues:function(e,t,r,s,o){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}n.checkObjectHasProperties(r,["from","end"]);i({verb:"DELETE",path:n.formatURL("/devices/{1}/streams/{2}/values",e,t),body:r,onSuccess:s,onError:o})},deleteDataStream:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"DELETE",path:n.formatURL("/devices/{1}/streams/{2}",e,t),onSuccess:r,onError:s})},postMultipleValues:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"POST",path:n.formatURL("/devices/{1}/updates",e),body:{values:t},onSuccess:r,onError:s})},getTriggers:function(e,t,r,s){var o=t,u=r,a=s;if(n.isFunc(o)){o={};u=t;a=r}if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/devices/{1}/triggers",e),urlparams:o,onSuccess:u,onError:a})},createTrigger:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(t,["stream","condition","value","name","callback_url"]);i({verb:"POST",path:n.formatURL("/devices/{1}/triggers",e),body:t,onSuccess:r,onError:s})},getTriggerDetails:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/devices/{1}/triggers/{2}",e,t),onSuccess:r,onError:s})},updateTrigger:function(e,t,r,s,o){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(r,["stream","condition","value","name","callback_url"]);i({verb:"PUT",path:n.formatURL("/devices/{1}/triggers/{2}",e,t),body:r,onSuccess:s,onError:o})},testTrigger:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)){throw new Error("Trigger ID should be an string")}i({verb:"POST",path:n.formatURL("/devices/{1}/triggers/{2}/test",e,t),onSuccess:r,onError:s})},deleteTrigger:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)){throw new Error("Trigger ID should be an string")}i({verb:"DELETE",path:n.formatURL("/devices/{1}/triggers/{2}",e,t),onSuccess:r,onError:s})},getRequestsLog:function(e,t,r,s){var o=t,u=r,a=s;if(n.isFunc(o)){o={};u=t;a=r}if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/devices/{1}/log",e),urlparams:o,onSuccess:u,onError:a})},remove:function(e,t,r){if(!n.isString(e)){throw new Error("Device ID should be an string")}i({verb:"DELETE",path:n.formatURL("/devices/{1}",e),onSuccess:t,onError:r})}};r.distribution={search:function(e,t,r){var s=e,o=t,u=r;if(n.isFunc(s)){s={};o=e;u=t}i({verb:"GET",path:"/distributions",urlparams:s,onSuccess:o,onError:u})},create:function(e,t,r){n.checkObjectHasProperties(e,["name","visibility"]);i({verb:"POST",path:"/distributions",body:e,onSuccess:t,onError:r})},getDetails:function(e,t,r){if(!n.isString(e)){throw new Error("ID should be a string")}i({verb:"GET",path:n.formatURL("/distributions/{1}",e),onSuccess:t,onError:r})},update:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(t,["name","visibility"]);i({verb:"PUT",path:n.formatURL("/distributions/{1}",e),body:t,onSuccess:r,onError:s})},getDevices:function(e,t,r,s){var o=t,u=r,a=s;if(n.isFunc(o)){o={};u=t;a=r}if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/distributions/{1}/devices",e),urlparams:o,onSuccess:u,onError:a})},addDevice:function(e,t,r,s){if(!n.isString(e)){throw new Error("Distribution ID should be an string")}if(!n.isString(t)){if(Object.prototype.toString.call(t)!=="[object Number]"){throw new Error("Device serial number not present or type mismatch")}else if(isNaN(t)){throw new Error("Device serial number type mismatch")}}i({verb:"POST",path:n.formatURL("/distributions/{1}/devices",e),body:{serial:t},onSuccess:r,onError:s})},remove:function(e,t,r){if(!n.isString(e)){throw new Error("Distribution ID should be an string")}i({verb:"DELETE",path:n.formatURL("/distributions/{1}",e),onSuccess:t,onError:r})},getDataStreams:function(e,t,r){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/distributions/{1}/streams",e),onSuccess:t,onError:r})},updateStream:function(e,t,r,s,o){var u=r,a=s,f=o;if(n.isFunc(r)){u={};a=r;f=s}if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"PUT",path:n.formatURL("/distributions/{1}/streams/{2}",e,t),body:u,onSuccess:a,onError:f})},getDataStreamDetails:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"GET",path:n.formatURL("/distributions/{1}/streams/{2}",e,t),onSuccess:r,onError:s})},deleteDataStream:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)||t.indexOf(" ")>=0){throw new Error("Stream name should be a string and not include spaces")}i({verb:"DELETE",path:n.formatURL("/distributions/{1}/streams/{2}",e,t),onSuccess:r,onError:s})},getTriggers:function(e,t,r,s){var o=t,u=r,a=s;if(n.isFunc(o)){o={};u=t;a=r}if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/distributions/{1}/triggers",e),urlparams:o,onSuccess:u,onError:a})},createTrigger:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(t,["stream","condition","value","name","callback_url"]);i({verb:"POST",path:n.formatURL("/distributions/{1}/triggers",e),body:t,onSuccess:r,onError:s})},getTriggerDetails:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}i({verb:"GET",path:n.formatURL("/distributions/{1}/triggers/{2}",e,t),onSuccess:r,onError:s})},updateTrigger:function(e,t,r,s,o){if(!n.isString(e)){throw new Error("ID should be an string")}n.checkObjectHasProperties(r,["stream","condition","value","name","callback_url"]);i({verb:"PUT",path:n.formatURL("/distributions/{1}/triggers/{2}",e,t),body:r,onSuccess:s,onError:o})},testTrigger:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)){throw new Error("Trigger ID should be an string")}i({verb:"POST",path:n.formatURL("/distributions/{1}/triggers/{2}/test",e,t),onSuccess:r,onError:s})},deleteTrigger:function(e,t,r,s){if(!n.isString(e)){throw new Error("ID should be an string")}if(!n.isString(t)){throw new Error("Trigger ID should be an string")}i({verb:"DELETE",path:n.formatURL("/distributions/{1}/triggers/{2}",e,t),onSuccess:r,onError:s})}};r.key={search:function(e,t,r){var s={device:e},o=t,u=r;if(n.isFunc(e)){s={};o=e;u=t}i({verb:"GET",path:"/keys",urlparams:s,onSuccess:o,onError:u})},create:function(e,t,r){if(!n.isObj(e)){throw new Error("Key should be an object")}n.checkObjectHasProperties(e,["name","permissions"]);i({verb:"POST",path:"/keys",body:e,onSuccess:t,onError:r})},getDetails:function(e,t,r){if(!n.isString(e)){throw new Error("Key should be a String")}i({verb:"GET",path:n.formatURL("/keys/{1}",e),onSuccess:t,onError:r})},update:function(e,t,r,s){if(!n.isString(e)){throw new Error("Key should be a String")}n.checkObjectHasProperties(t,["name","permissions"]);i({verb:"PUT",path:n.formatURL("/keys/{1}",e),body:t,onSuccess:r,onError:s})},regenerate:function(e,t,r){if(!n.isString(e)){throw new Error("Key should be a String")}i({verb:"POST",path:n.formatURL("/keys/{1}/regenerate",e),onSuccess:t,onError:r})},remove:function(e,t,r){if(!n.isString(e)){throw new Error("Key should be a String")}i({verb:"DELETE",path:n.formatURL("/keys/{1}",e),onSuccess:t,onError:r})}};r.setKey=function(e){if(!n.isString(e)){throw new Error("Key ID should be a String")}t.key=e};return r};e.fromISO8601toDate=function(e){var t=/\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/;if(t.test(e)){return new Date(e)}};e.getISO8601Timestamp=function(e){var t;if(Object.prototype.toString.call(e)==="[object Date]"){t=e}else if(/^[0-9]+$/.test(""+e)){t=new Date(e)}else{t=new Date}return t.toISOString()};return e})